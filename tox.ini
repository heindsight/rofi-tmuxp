[tox]
isolated_build = True
envlist =
    lint
    {py37, py38, py39}-tmuxp{1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9}-kaptan{0.5.10, 0.5.11, 0.5.12}
    {py310,py311}-tmuxp{1.5, 1.6, 1.7, 1.8, 1.9}-kaptan0.5.12

[common]
sources = rofi_tmuxp.py test

[gh-actions]
python =
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: lint, py310
    3.11: py311

[testenv]
commands = pytest --basetemp="{envtmpdir}" {posargs}
deps =
    tmuxp1.1: tmuxp~=1.1.0
    tmuxp1.2: tmuxp~=1.2.0
    tmuxp1.3: tmuxp~=1.3.0
    tmuxp1.4: tmuxp~=1.4.0
    tmuxp1.5: tmuxp~=1.5.0
    tmuxp1.6: tmuxp~=1.6.0
    tmuxp1.7: tmuxp~=1.7.0
    tmuxp1.8: tmuxp~=1.8.0
    tmuxp1.9: tmuxp~=1.9.0
    kaptan0.5.10: kaptan==0.5.10
    kaptan0.5.11: kaptan==0.5.11
    kaptan0.5.12: kaptan==0.5.12
    pytest
    pytest-cov
    pytest-mock
    pytest-randomly

[testenv:lint]
extras = dev
deps =
commands =
    flake8 {[common]sources}
    black --check --verbose --diff {[common]sources}
    isort --check-only --diff {[common]sources}
    rstcheck -r .

[testenv:format]
extras = dev
deps =
commands =
    black --verbose {[common]sources}
    isort --atomic {[common]sources}

[flake8]
max-line-length = 88

[pytest]
addopts =
    --cov=rofi_tmuxp
    --cov=test
    --cov-report=term-missing
    --cov-fail-under=100
    --cov-branch
    --no-cov-on-fail
